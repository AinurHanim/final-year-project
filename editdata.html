<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Penyelenggaraan Data Sekolah Koki</title>
    <style>
        /* (Styling code remains the same) */
        /* General Body Styling */
        body {
            font-family: Arial, sans-serif;
            background-color: #cececc;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }

        /* Main Container */
        .container {
            background-color: #fafafa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.68);
            width: 90%;
            margin-top: 20px;
            transition: transform 0.2s;
            /* Smooth zoom transition */
        }

        /* Header Styling */
        h2 {
            color: #0056b3;
            font-size: 35px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        /* Tabs Styling */
        .tabs {
            width: 100%;
        }

        .tab-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #ccc;
            margin-bottom: 20px;
        }

        .tab-button {
            background-color: #f0f0f0;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }

        .tab-button.active {
            background-color: #64a3d6;
            color: white;
        }

        .tab-content {
            padding: 20px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* Search Input Styling */
        .search-input {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
        }

        .search-input input[type="text"] {
            width: calc(100% - 120px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
        }

        .search-input button {
            padding: 10px 20px;
            background-color: #0078D4;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .search-input button:hover {
            background-color: whitesmoke;
            color: #3f3e3e;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.336);
        }

        /* Suggestions Box Styling */
        .suggestions {
            border: 1px solid #007bff;
            display: none;
            /* Hidden initially */
            position: absolute;
            z-index: 1000;
            background-color: white;
            max-height: 200px;
            overflow-y: auto;
            width: calc(100% - 20px);
            font-size: 14px;
            border-radius: 5px;
            padding: 5px;
            top: 40px;
        }

        .suggestions div {
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid #f4f4f4;
        }

        .suggestions div:hover {
            background-color: #007bff;
            color: #fff;
        }

        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        td {
            background-color: #fff;
            font-size: 16px;
        }

        /* Table Container Styling */
        #table-container {
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 80em;
            /* Adjust width here */

            margin: 20px auto;
            /* Center the container */
        }

        /* Ensure the dropdown is the same width as the text input */
        #dropdownAcara {
            width: calc(100% - 120px);
            /* Match the width of the text input */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
        }

        .custom-input {
            width: 400px;
            /* Set your desired width */
            padding: 10px;
            /* Optional: Add padding for better appearance */
            border: 1px solid #ccc;
            /* Optional: Customize border */
            border-radius: 4px;
            /* Optional: Rounded corners */
        }

        .custom-select {
            width: 400px;
            /* Set your desired width */
            padding: 10px;
            /* Optional: Add padding for better appearance */
            border: 1px solid #ccc;
            /* Optional: Customize border */
            border-radius: 4px;
            /* Optional: Rounded corners */
        }

        #cariAcara {
            width: calc(100% - 120px);
            /* Adjust width */
            padding: 10px;
            /* Add padding */
            border: 1px solid #ccc;
            /* Border styling */
            border-radius: 5px;
            /* Rounded corners */
            background-color: #fafafa;
            /* Background color */
            font-size: 16px;
            /* Font size */
        }

        #editContainer label {
            font-weight: bold;
            color: #333;
        }

        #editContainer input[type="text"],
        #editContainer input[type="date"],
        #editContainer select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
            color: #333;
        }

        #editContainer input[type="text"]::placeholder {
            color: #888;
        }

        #editContainer input[type="date"] {
            font-family: 'Arial', sans-serif;
            /* Customize font if needed */
        }

        #editContainer select {
            background-color: #f9f9f9;
            color: #555;
        }

        #editContainer button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #editContainer button:hover {
            background-color: whitesmoke;
        }

        .tooltip-icon {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .tooltip {
            visibility: hidden;
            width: 450px;
            background-color: rgb(105, 161, 214);
            color: #000000;
            text-align: center;
            border-radius: 6px;
            padding: 1em;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -75px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }


    </style>
</head>

<body>
    <div class="container">
        <h2>PENYELENGGARAAN DATA SEKOLAH</h2>

        <!-- Tab Navigation -->
        <div class="tabs">
            <div class="tab-header">
                <button class="tab-button active" onclick="showTab('guru')">Maklumat Guru</button>
                <button class="tab-button" onclick="showTab('pelajar')">Maklumat Pelajar</button>
                <button class="tab-button" onclick="showTab('acara')">Maklumat Acara</button>
                <button class="tab-button" onclick="showTab('kokurikulum')">Maklumat Kokurikulum</button>
            </div>

            <!-- Inside the Maklumat Guru Tab -->
            <div id="guru" class="tab-pane active">
                <div class="search-input">
                    <label for="searchGuru">Cari Guru:</label>
                    <input type="text" id="searchGuru" placeholder="Sila pilih nama guru" oninput="liveSearch()">
                    <button onclick="searchData()">Cari</button>
                    <div id="suggestions" class="suggestions"></div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nama Guru</th>
                                <th>Kategori Unit/Badan</th>
                                <th>Nama Kelab</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="teacherTable">
                            <!-- Data will be populated here from the database -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Maklumat Pelajar Tab Content -->
            <div id="pelajar" class="tab-pane">
                <!-- Search Section -->
                <div class="search-input">
                    <label for="searchPelajar">Cari Pelajar:</label>
                    <input type="text" id="searchPelajar" placeholder="Sila pilih nama pelajar"
                        oninput="liveSearchPelajar()">
                    <button onclick="searchPelajarData()">Cari</button>
                    <div id="pelajarSuggestions" class="suggestions"></div>
                </div>

                <!-- Table Section for Pelajar Data -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nama Pelajar</th>
                                <th>No Ic</th>
                                <th>Kelas</th>
                                <th>Pencapaian</th>
                                <th>Acara</th>
                                <th>Nama Kategori Unit</th>
                                <th>Nama Kelab</th>
                                <th>Tindakan</th>
                            </tr>
                        </thead>
                        <tbody id="pelajarTable">
                            <!-- Data will be populated here from the database -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Maklumat Acara Tab Content -->
            <div id="acara" class="tab-pane">
                <!-- Dropdown for Searching Events -->
                <div class="search-input">
                    <label for="cariAcara">Cari Acara:</label>
                    <select id="cariAcara">
                        <option value="">Sila pilih acara</option>
                        <!-- Event options will be populated dynamically -->
                    </select>
                    <button onclick="searchAcaraData()">Cari</button>
                </div>

                <!-- Table Section for Acara Data -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nama Acara</th>
                                <th>Tarikh</th>
                                <th>Tempat</th>
                                <th>Peringkat</th>
                                <th>Didaftarkan oleh</th>
                                <th>Kategori Badan / Unit</th>
                                <th>Nama Kelab</th>
                                <th>Tindakan</th>
                            </tr>
                        </thead>
                        <tbody id="acaraTable">
                            <!-- Data will be populated here from the database -->
                        </tbody>
                    </table>
                </div>

                <!-- Container for Editing Acara -->
                <div id="editContainer" style="display: none; margin-top: 20px;">
                    <h3>Edit Acara</h3>

                    <label for="editNamaAcara">Nama Acara:
                        <span class="tooltip-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94"/>
                            </svg>
                            <span class="tooltip">Pastikan Nama Acara yang diisi sama seperti Nama Acara di atas</span>
                        </span>
                    </label>

                    <input type="text" id="editNamaAcara" placeholder="Sila isi nama acara" required>
                    
                    <br>

                    <label for="editTarikh">Tarikh:</label>
                    <input type="date" id="editTarikh" placeholder="dd/mm/yyyy" required>
                    <br>

                    <label for="editTempat">Tempat:</label>
                    <input type="text" id="editTempat" placeholder="Sila isi lokasi acara" required>
                    <br>

                    <label for="editPeringkat">Peringkat:</label>
                    <select id="editPeringkat" required>
                        <option value="" selected disabled>Sila pilih peringkat acara</option>
                        <option value="Sekolah">Sekolah</option>
                        <option value="Zon/Daerah">Zon/Daerah</option>
                        <option value="Bahagian (Sabah & Sarawak)">Bahagian (Sabah & Sarawak)</option>
                        <option value="Negeri">Negeri</option>
                        <option value="Kebangsaan">Kebangsaan</option>
                        <option value="Antarabangsa">Antarabangsa</option>
                    </select>

                    <br>
                    <button id="saveButton" onclick="saveAcaraData()">Simpan</button>
                </div>

            </div>


            <div id="kokurikulum" class="tab-pane">
                <div class="tab-header">
                    <button class="tab-button active" onclick="showKokurikulumTab('tambahKelab')">Tambah Kelab
                        Baru</button>
                    <button class="tab-button" onclick="showKokurikulumTab('senaraiKelab')">Senarai Kelab yang
                        Ditubuhkan</button>
                </div>

                <div id="tambahKelab" class="tab-pane active">
                    <h3>Tambah Kelab Baru</h3>
                    <form id="addClubForm" onsubmit="addClub(event)">
                        <label for="typeUnit">Kategori Badan / Unit:</label>
                        <select id="typeUnit" name="typeUnit" required style="width: 200px;">
                            <option value="">Pilih Kategori</option>
                            <option value="SUKAN DAN PERMAINAN">SUKAN DAN PERMAINAN</option>
                            <option value="PERSATUAN (AKADEMIK)">PERSATUAN (AKADEMIK)</option>
                            <option value="KELAB (BUKAN AKADEMIK)">KELAB (BUKAN AKADEMIK)</option>
                            <option value="BADAN BERUNIFORM">BADAN BERUNIFORM</option>
                        </select>
                        <br><br>
                        <label for="namaKelab">Nama Kelab:</label>
                        <input type="text" id="namaKelab" required style="width: 200px;">
                        <button type="submit">Tambah Kelab</button>
                    </form>
                </div>

                <div id="senaraiKelab" class="tab-pane active">
                    <h3>Senarai Kelab yang Ditubuhkan</h3>
                    <!-- "Pilih Kategori" Dropdown -->
                    <select id="kategoriSenarai">
                        <option value="">Pilih Kategori</option>
                        <option value="SUKAN DAN PERMAINAN">SUKAN DAN PERMAINAN</option>
                        <option value="PERSATUAN (AKADEMIK)">PERSATUAN (AKADEMIK)</option>
                        <option value="KELAB (BUKAN AKADEMIK)">KELAB (BUKAN AKADEMIK)</option>
                        <option value="BADAN BERUNIFORM">BADAN BERUNIFORM</option>
                    </select>

                    <!-- Table to Display Clubs -->
                    <table id="clubListTable">
                        <thead>
                            <tr>
                                <th>Nama Kelab</th>
                                <th>Tindakan</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Clubs will be listed here dynamically -->
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>


    <script>
        function showTab(tabName) {
            // Hide all tab panes
            const tabPanes = document.querySelectorAll('.tab-pane');
            tabPanes.forEach(pane => pane.classList.remove('active'));

            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));

            // Show selected tab pane and activate its button
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab-button[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        function displayNoGuruDataMessage() {
    const tableBody = document.getElementById("teacherTable");
    tableBody.innerHTML = ""; // Clear previous results

    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.setAttribute("colspan", 4); // Adjust the colspan to match the number of columns
    td.textContent = "Tiada data dalam rekod";
    td.style.textAlign = "center";
    tr.appendChild(td);

    tableBody.appendChild(tr);
}

        function searchData() {
            console.log("Cari button clicked"); // Debugging statement
            const selectedGuru = document.getElementById('searchGuru').value;
            console.log("Selected Guru:", selectedGuru); // Debugging statement
            if (selectedGuru) {
                fetch(`getTeacherData.php?namaGuru=${encodeURIComponent(selectedGuru)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            displayTeacherData(data);
                        } else {
                            displayNoGuruDataMessage(); // Call the function when no data is returned
                        }
                    })
                    .catch(error => {
                console.error('Error fetching data:', error);
                displayNoGuruDataMessage(); // Display the message if an error occurs
            });
    } else {
        displayNoGuruDataMessage(); // Display the message if no input is provided
    }
}

        function liveSearch() {
            const input = document.getElementById('searchGuru').value;
            const suggestionsBox = document.getElementById('suggestions');
            suggestionsBox.innerHTML = '';
            suggestionsBox.style.display = 'none';

            if (input.length > 0) {
                fetch(`getSuggestions.php?query=${encodeURIComponent(input)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            suggestionsBox.style.display = 'block';
                            data.forEach(suggestion => {
                                const div = document.createElement('div');
                                div.textContent = suggestion['Nama Guru'];
                                div.onclick = () => {
                                    document.getElementById('searchGuru').value = suggestion['Nama Guru'];
                                    suggestionsBox.innerHTML = '';
                                    suggestionsBox.style.display = 'none';
                                };
                                suggestionsBox.appendChild(div);
                            });
                        }
                    })
                    .catch(error => console.error('Error fetching suggestions:', error));
            }
        }

        function displayTeacherData(data) {
            const tableBody = document.getElementById("teacherTable");
            tableBody.innerHTML = ""; // Clear previous results

            data.forEach(row => {
                const tr = document.createElement("tr");

                const namaGuruCell = document.createElement("td");
                namaGuruCell.textContent = row.nama; // Keep this read-only
                tr.appendChild(namaGuruCell);

                const typeUnitCell = document.createElement("td");
                typeUnitCell.textContent = row.typeUnit; // Initially display text
                tr.appendChild(typeUnitCell);

                const namaUnitCell = document.createElement("td");
                namaUnitCell.textContent = row.namaUnit; // Initially display text
                tr.appendChild(namaUnitCell);

                const aksiCell = document.createElement("td");
                aksiCell.innerHTML = `
            <button onclick="editTeacher(this)">Edit</button>
            <button style="display:none;" onclick="saveTeacher(this)">Simpan</button>
        `;
                tr.appendChild(aksiCell);

                tableBody.appendChild(tr);
            });
        }

        function editTeacher(button) {
    const row = button.closest("tr");
    const typeUnitCell = row.cells[1];
    const namaUnitCell = row.cells[2];

    // Create the dropdown for Kategori Unit/Badan
    typeUnitCell.innerHTML = `
        <select id="kategoriUnit" onchange="fetchKelabData(this)">
            <option value="">Pilih Kategori</option>
            <option value="SUKAN DAN PERMAINAN">SUKAN DAN PERMAINAN</option>
            <option value="PERSATUAN (AKADEMIK)">PERSATUAN (AKADEMIK)</option>
            <option value="KELAB (BUKAN AKADEMIK)">KELAB (BUKAN AKADEMIK)</option>
            <option value="BADAN BERUNIFORM">BADAN BERUNIFORM</option>
        </select>
    `;

    // Create the input for Nama Kelab
    namaUnitCell.innerHTML = `
        <select id="namaKelab">
            <option value="">Pilih Nama Kelab</option>
        </select>
    `;

            // Show the "Simpan" button and hide the "Edit" button
            button.style.display = "none";
            row.querySelector("button[onclick='saveTeacher(this)']").style.display = "inline";
        }

        function fetchKelabData(selectElement) {
    const selectedKategori = selectElement.value;
    const kelabDropdown = document.getElementById('namaKelab');

    // Reset options
    kelabDropdown.innerHTML = '<option value="">Pilih Nama Kelab</option>';

    if (selectedKategori) {
        fetch(`getKelabByKategori.php?kategori=${encodeURIComponent(selectedKategori)}`)
            .then(response => response.json())
            .then(data => {
                data.forEach(kelab => {
                    const option = document.createElement('option');
                    option.value = kelab.name; // Match JSON key from PHP
                    option.textContent = kelab.name;
                    kelabDropdown.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error fetching kelab data:', error);
                alert('Failed to load club data. Please try again.');
            });
    }
}



        function saveTeacher(button) {
            const row = button.closest("tr");
            const typeUnitCell = row.cells[1].querySelector("select").value; // Get selected value
            const namaUnitCell = row.cells[2].querySelector("select").value; // Get selected value
            const namaGuruCell = row.cells[0].textContent; // Get the name of the teacher

            console.log('Data being sent to server:', {
                typeUnit: typeUnitCell,
                namaUnit: namaUnitCell,
                nama: namaGuruCell
            });

            // Send updated data to the server
            fetch('updateTeacherData.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ typeUnit: typeUnitCell, namaUnit: namaUnitCell, nama: namaGuruCell }) // Include the name of the teacher
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Respons rangkaian tidak baik');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        // Update the table cells with the new values
                        row.cells[1].textContent = typeUnitCell;
                        row.cells[2].textContent = namaUnitCell;

                        // Show the "Edit" button and hide the "Simpan" button
                        button.style.display = "none";
                        row.querySelector("button[onclick='editTeacher(this)']").style.display = "inline";

                        // Replace Swal.fire with a standard alert
                        alert('Data berjaya dikemaskini!');
                    } else {
                        alert('Terdapat ralat semasa mengemaskini data: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Terdapat ralat semasa menghantar permintaan ke pelayan.');
                });
        }


        function searchPelajarData() {
            const selectedPelajar = document.getElementById('searchPelajar').value;
            if (selectedPelajar) {
                fetch(`getPelajarData.php?namaPelajar=${encodeURIComponent(selectedPelajar)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            displayPelajarData(data);
                        } else {
                            displayNoPelajarDataMessage();
                        }
                    })
                    .catch(error => console.error('Error fetching data:', error));
            }
        }

        function liveSearchPelajar() {
            const input = document.getElementById('searchPelajar').value;
            const suggestionsBox = document.getElementById('pelajarSuggestions');

            suggestionsBox.innerHTML = '';
            suggestionsBox.style.display = 'none';

            if (input.length > 0) {
                fetch(`getPelajarSuggestions.php?query=${encodeURIComponent(input)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            suggestionsBox.style.display = 'block';
                            data.forEach(suggestion => {
                                const div = document.createElement('div');
                                div.textContent = suggestion['NAMA'];
                                div.onclick = () => {
                                    document.getElementById('searchPelajar').value = suggestion['NAMA'];
                                    suggestionsBox.innerHTML = '';
                                    suggestionsBox.style.display = 'none';
                                };
                                suggestionsBox.appendChild(div);
                            });
                        }
                    })
                    .catch(error => console.error('Error fetching suggestions:', error));
            }
        }


        function displayPelajarData(data) {
            const tableBody = document.getElementById("pelajarTable");
            tableBody.innerHTML = ""; // Clear previous results

            data.forEach(row => {
                const tr = document.createElement("tr");

                const namaPelajarCell = document.createElement("td");
                namaPelajarCell.textContent = row.nama_pelajar; // Match PHP JSON key
                tr.appendChild(namaPelajarCell);

                const noIcCell = document.createElement("td");
                noIcCell.textContent = row.no_ic; // Match PHP JSON key
                tr.appendChild(noIcCell);

                const kelasCell = document.createElement("td");
                kelasCell.textContent = row.kelas;
                tr.appendChild(kelasCell);

                const pencapaianCell = document.createElement("td");
                pencapaianCell.textContent = row.pencapaian; // Initially display text
                tr.appendChild(pencapaianCell);

                const acaraCell = document.createElement("td");
                acaraCell.textContent = row.acara;
                tr.appendChild(acaraCell);

                const namaKategoriUnitCell = document.createElement("td");
                namaKategoriUnitCell.textContent = row.kategori_badan_unit; // Match PHP JSON key
                tr.appendChild(namaKategoriUnitCell);

                const namaKelabCell = document.createElement("td");
                namaKelabCell.textContent = row.nama_kelab; // Match PHP JSON key
                tr.appendChild(namaKelabCell);

                const tindakanCell = document.createElement("td");
                tindakanCell.innerHTML = `
            <button onclick="editPelajarData(this)">Edit</button>
            <button style="display:none;" onclick="savePelajarData(this)">Simpan</button>
        `;
                tr.appendChild(tindakanCell);

                tableBody.appendChild(tr);
            });
        }

        function editPelajarData(button) {
            const row = button.closest("tr");
            const pencapaianCell = row.cells[3]; // Pencapaian cell

            // Create the select dropdown for Pencapaian
            const selectPencapaian = `
        <select id="pencapaianSelect" required>
            <option value="">Peringkat Penyertaan</option>
            <option value="Johan / Pertama">Johan / Pertama</option>
            <option value="Naib Johan / Kedua">Naib Johan / Kedua</option>
            <option value="Ketiga">Ketiga</option>
            <option value="Keempat">Keempat</option>
            <option value="Kelima">Kelima</option>
            <option value="Peserta">Peserta</option>
        </select>
    `;

            // Replace the cell content with the select dropdown
            pencapaianCell.innerHTML = selectPencapaian;

            // Hide the Edit button and show the Simpan button
            button.style.display = "none";
            row.querySelector("button[onclick='savePelajarData(this)']").style.display = "inline";
        }

        function savePelajarData(button) {
            const row = button.closest("tr");
            const pencapaianCell = row.cells[3].querySelector("select").value; // Get selected value
            const namaPelajar = row.cells[0].textContent; // Get the name of the student

            // Send updated data to the server
            fetch('updatePelajarData.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ pencapaian: pencapaianCell, nama_pelajar: namaPelajar }) // Include the name of the student
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Respons rangkaian tidak baik');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        // Update the table cell with the new value
                        row.cells[3].innerHTML = pencapaianCell; // Set as plain text

                        // Show the Edit button and hide the Simpan button
                        button.style.display = "none";
                        row.querySelector("button[onclick='editPelajarData(this)']").style.display = "inline";

                        // Replace Swal.fire with alert
                        alert('Pencapaian berjaya dikemaskini!');
                    } else {
                        alert('Terdapat ralat semasa mengemaskini data: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Terdapat ralat semasa menghantar permintaan ke pelayan.');
                });
        }



        function displayNoPelajarDataMessage() {
            const tableBody = document.getElementById("pelajarTable");
            tableBody.innerHTML = "";

            const tr = document.createElement("tr");
            const td = document.createElement("td");
            td.setAttribute("colspan", 8);
            td.textContent = "Tiada data dalam rekod";
            td.style.textAlign = "center";
            tr.appendChild(td);

            tableBody.appendChild(tr);
        }

        //tab acara 
        function populateAcaraDropdown() {
            fetch('getAcaraList.php')
                .then(response => response.json())
                .then(data => {
                    const acaraDropdown = document.getElementById('cariAcara');
                    acaraDropdown.innerHTML = '<option value="">Sila pilih acara</option>';
                    data.forEach(event => {
                        const option = document.createElement('option');
                        option.value = event.namaEvent;
                        option.textContent = `${event.namaEvent} (${event.tarikh}, ${event.tempat})`;
                        acaraDropdown.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching acara list:', error));
        }

        // Call populateAcaraDropdown to load event names when the page loads
        window.onload = function () {
            populateAcaraDropdown();
        };

        function searchAcaraData() {
            const selectedAcara = document.getElementById('cariAcara').value;
            if (selectedAcara) {
                fetch(`getAcaraData.php?namaAcara=${encodeURIComponent(selectedAcara)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (Object.keys(data).length > 0) { // Check if data object is not empty
                            displayAcaraData([data]); // Wrap in an array if it's a single result
                        } else {
                            displayNoAcaraDataMessage();
                        }
                    })
                    .catch(error => console.error('Error fetching acara data:', error));
            } else {
                displayNoAcaraDataMessage();
            }
        }





        function displayAcaraData(data) {
            const tableBody = document.getElementById("acaraTable");
            tableBody.innerHTML = ""; // Clear previous results

            data.forEach(row => {
                const tr = document.createElement("tr");
                tr.setAttribute("data-id", row.id); // Set ID for later reference

                const namaAcaraCell = document.createElement("td");
                namaAcaraCell.textContent = row.namaEvent; // Ensure this matches your database column
                tr.appendChild(namaAcaraCell);

                const tarikhCell = document.createElement("td");
                tarikhCell.textContent = row.tarikh;
                tr.appendChild(tarikhCell);

                const tempatCell = document.createElement("td");
                tempatCell.textContent = row.tempat;
                tr.appendChild(tempatCell);

                const peringkatCell = document.createElement("td");
                peringkatCell.textContent = row.peringkat;
                tr.appendChild(peringkatCell);

                const didaftarkanOlehCell = document.createElement("td");
                didaftarkanOlehCell.textContent = row.registerBy; // Ensure this matches your database column
                tr.appendChild(didaftarkanOlehCell);

                const kategoriUnitCell = document.createElement("td");
                kategoriUnitCell.textContent = row.kategoriUnit; // Ensure this matches your database column
                tr.appendChild(kategoriUnitCell);

                const namaKelabCell = document.createElement("td");
                namaKelabCell.textContent = row.namaKelab; // Ensure this matches your database column
                tr.appendChild(namaKelabCell);

                const tindakanCell = document.createElement("td");
                tindakanCell.innerHTML = `<button onclick="editAcaraData(${row.id})">Edit</button>`;
                tr.appendChild(tindakanCell);

                tableBody.appendChild(tr);
            });
        }

        function editAcaraData(id) {
            fetch(`getAcaraData.php?id=${id}`)
                .then(response => response.json())
                .then(rowData => {
                    const editContainer = document.getElementById("editContainer");
                    editContainer.style.display = "block";

                    // Populate the edit fields with existing data
                    document.getElementById("editNamaAcara").value = rowData.namaEvent || "";
                    document.getElementById("editTarikh").value = rowData.tarikh || "";
                    document.getElementById("editTempat").value = rowData.tempat || "";
                    document.getElementById("editPeringkat").value = rowData.peringkat || "";
                })
                .catch(error => console.error('Error fetching acara data:', error));
        }



        function saveAcaraData() {
            const namaAcara = document.getElementById("editNamaAcara").value;
            const tarikh = document.getElementById("editTarikh").value;
            const tempat = document.getElementById("editTempat").value;
            const peringkat = document.getElementById("editPeringkat").value;

            if (!namaAcara || !tarikh || !tempat || !peringkat) {
                alert('Please complete all fields.');
                return; // Exit if any required data is missing
            }

            // Prepare the data for update
            const data = { namaAcara, tarikh, tempat, peringkat };

            fetch('updateAcaraData.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Data telah berjaya dikemas kini.');

                        // Hide the edit container
                        const editContainer = document.getElementById("editContainer");
                        editContainer.style.display = "none";

                        // Refresh the table to reflect the updated data
                        const selectedAcara = document.getElementById("cariAcara").value;
                        if (selectedAcara) {
                            fetch(`getAcaraData.php?namaAcara=${encodeURIComponent(selectedAcara)}`)
                                .then(response => response.json())
                                .then(updatedData => {
                                    displayAcaraData([updatedData]); // Wrap updated data in an array
                                })
                                .catch(error => console.error('Error refreshing table data:', error));
                        }
                    } else {
                        alert('' + (data.message || 'Ralat berlaku semasa menyimpan data.'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Ralat rangkaian berlaku semasa menyimpan data.');
                });
        }




        function displayNoAcaraDataMessage() {
            const tableBody = document.getElementById("acaraTable");
            tableBody.innerHTML = "";

            const tr = document.createElement("tr");
            const td = document.createElement("td");
            td.setAttribute("colspan", 8);
            td.textContent = "Tiada data dalam rekod ";
            td.style.textAlign = "center";
            tr.appendChild(td);

            tableBody.appendChild(tr);
        }

        function cancelEdit(button) {
            const row = button.closest("tr");
            // Reset the row to its original state (you may need to fetch the original data again)
            fetch(`getAcaraData.php?id=${row.dataset.id}`) // Use the event ID to fetch original data
                .then(response => response.json())
                .then(data => {
                    displayAcaraData([data]); // Assuming data is an array with one object
                });
        }
        //maklumat koko

        function showKokurikulumTab(tabName) {
            const subTabPanes = document.querySelectorAll('#kokurikulum .tab-pane');
            subTabPanes.forEach(pane => pane.classList.remove('active'));

            const subTabButtons = document.querySelectorAll('#kokurikulum .tab-button');
            subTabButtons.forEach(button => button.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            document.querySelector(`#kokurikulum .tab-button[onclick="showKokurikulumTab('${tabName}')"]`).classList.add('active');
        }

        function addClub(event) {
            event.preventDefault(); // Prevent the default form submission

            const typeUnit = document.getElementById('typeUnit').value;
            const namaKelab = document.getElementById('namaKelab').value;

            const data = {
                kategori: typeUnit,
                namaKelab: namaKelab
            };

            fetch('addClub.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message using alert
                        alert('Penambahan kelab baharu berjaya.');

                        document.getElementById('addClubForm').reset(); // Reset the form
                    } else {
                        alert('Penambahan kelab baharu tidak berjaya.' + (data.message || 'Ralat tidak dikenali.'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Ralat rangkaian berlaku semasa menyimpan data.');
                });
        }


        document.getElementById("kategoriSenarai").addEventListener("change", function () {
        const selectedCategory = this.value;

        if (selectedCategory) {
            // Fetch clubs based on selected category
            fetch(`getClubsByCategory.php?kategori=${encodeURIComponent(selectedCategory)}`)
                .then(response => response.json())
                .then(data => {
                    const clubListTable = document.getElementById("clubListTable").getElementsByTagName('tbody')[0];
                    clubListTable.innerHTML = ""; // Clear existing rows

                    if (data.length > 0) {
                        // Populate table with fetched data
                        data.forEach(club => {
                            const row = document.createElement("tr");

                            // Club Name Column
                            const nameCell = document.createElement("td");
                            nameCell.textContent = club.name; // Assuming each club has a 'name' property
                            row.appendChild(nameCell);

                            // Actions Column
                            const actionCell = document.createElement("td");
                            const deleteButton = document.createElement("button");
                            deleteButton.textContent = "Buang";
                            deleteButton.classList.add("btn", "btn-danger"); // Add Bootstrap styles if you're using Bootstrap
                            deleteButton.addEventListener("click", function () {
                                // Confirmation Alert
                                if (confirm(`Adakah anda pasti ingin membuang kelab "${club.name}"?`)) {
                                    // Call deleteClub.php to delete the club from the database
                                    fetch(`deleteClub.php?id=${encodeURIComponent(club.id)}`, { method: "POST" })
                                        .then(response => response.json())
                                        .then(result => {
                                            if (result.success) {
                                                alert("Kelab berjaya dibuang!");
                                                row.remove(); // Remove row from table
                                            } else {
                                                alert("Ralat semasa membuang kelab.");
                                            }
                                        })
                                        .catch(error => console.error("Error deleting club:", error));
                                }
                            });
                            actionCell.appendChild(deleteButton);
                            row.appendChild(actionCell);

                            clubListTable.appendChild(row);
                        });
                    } else {
                        // No clubs found message
                        const row = document.createElement("tr");
                        const cell = document.createElement("td");
                        cell.textContent = "Tiada kelab dalam kategori ini.";
                        cell.colSpan = 2; // Span across both columns
                        row.appendChild(cell);
                        clubListTable.appendChild(row);
                    }
                })
                .catch(error => console.error("Error fetching data:", error));
        }
    });


    </script>
    </div>
    </div>
</body>

</html>